{"manifest": "ethpm/3", "sources": {"Depositor.vy": {"urls": [], "checksum": {"algorithm": "md5", "hash": "0xefdbbd0a92455ed9f1a496f2a4b0b8d0"}, "content": "# @version 0.3.4\n\nfrom vyper.interfaces import ERC20\n\n# Token address in network\nUSDC: constant(address) = 0x5FfbaC75EFc9547FBc822166feD19B05Cd5890bb\nWETH: constant(address) = 0xB4FBF271143F4FBf7B91A5ded31805e42b2208d6\n\n# Address of NonfungiblePositionManager\nNonfungiblePositionManagerAddress: constant(address) = 0xC36442b4a4522E871399CD717aBDD847Ab11FE88\n# Address of Uniswap V3 SwapRouter\nSwapRouterAddress: constant(address) = 0xE592427A0AEce92De3Edee1F18E0157C05861564\n\n# Fee tier of Pool\npoolFee: constant(uint256) = 3000\n\n# Parameter in mint function of NonfungiblePositionManager\nstruct MintParams:\n    token0: address\n    token1: address\n    fee: uint256\n    tickLower: int24\n    tickUpper: int24\n    amount0Desired: uint256\n    amount1Desired: uint256\n    amount0Min: uint256\n    amount1Min: uint256\n    recipient: address\n    deadline: uint256\n\n# Return arguments of mint function of NonfungiblePositionManager\nstruct MintReturnParams:\n    tokenId: uint256\n    liquidity: uint128\n    amount0: uint256\n    amount1: uint256\n\n# Arguments for SwapRouter to swap tokens\nstruct ExactInputSingleParams:\n    tokenIn: address\n    tokenOut: address\n    fee: uint24\n    recipient: address\n    deadline: uint256\n    amountIn: uint256\n    amountOutMinimum: uint256\n    sqrtPriceLimitX96: uint160\n\n# Interface of NonfungiblePositionManager\ninterface INonfungiblePositionManager:\n    def mint(params: MintParams) -> MintReturnParams: nonpayable\n\ninterface ISwapRouter:\n    def exactInputSingle(params: ExactInputSingleParams) -> uint256: payable\n\n# Event for logging that user has deposited\nevent Deposit:\n    depositor: indexed(address)\n    liquidity: uint128\n    amount0: uint256\n    amount1: uint256\n\n# Deposit with ETH\n@payable\n@external\ndef deposit(tickLower: int24, tickUpper: int24) -> MintReturnParams:\n\n    assert msg.value > 0\n\n    deadline: uint256 = block.timestamp + 15\n\n    # Divide and Swap ETH to USDC and WETH respectively\n    amount0ToMint: uint256 = ISwapRouter(SwapRouterAddress).exactInputSingle(ExactInputSingleParams({tokenIn: WETH, tokenOut: USDC, fee: 3000, recipient: msg.sender, deadline: deadline, amountIn: msg.value / 2, amountOutMinimum: 0, sqrtPriceLimitX96: 0}), value = msg.value / 2)\n    amount1ToMint: uint256 = ISwapRouter(SwapRouterAddress).exactInputSingle(ExactInputSingleParams({tokenIn: WETH, tokenOut: WETH, fee: 3000, recipient: msg.sender, deadline: deadline, amountIn: msg.value / 2, amountOutMinimum: 0, sqrtPriceLimitX96: 0}), value = msg.value / 2)\n\n    # Approve NonfungiblePositionManger to transfer swapped USDC and WETH\n    ERC20(USDC).approve(NonfungiblePositionManagerAddress, amount0ToMint)\n    ERC20(WETH).approve(NonfungiblePositionManagerAddress, amount1ToMint)\n\n    # Set mint arguments\n    params: MintParams = MintParams({token0: USDC, token1: WETH, fee: poolFee, tickLower: tickLower, tickUpper: tickUpper, amount0Desired: amount0ToMint, amount1Desired: amount1ToMint, amount0Min: 0, amount1Min: 0, recipient: msg.sender, deadline: block.timestamp})\n    # Deposit to USDC-WETH pool with poolFee tier, etc.\n    result: MintReturnParams = INonfungiblePositionManager(NonfungiblePositionManagerAddress).mint(params)\n\n    # Log deposit\n    log Deposit(msg.sender, result.liquidity, result.amount0, result.amount1)\n\n    # Refund rest USDC to user if it remains\n    if result.amount0 < amount0ToMint:\n        # Remove allowance of NonfungiblePositionManger from this contract\n        ERC20(USDC).approve(NonfungiblePositionManagerAddress, 0)\n        # Rest amount of USDC after deposit\n        refund0: uint256 = amount0ToMint - result.amount0\n        # Refund USDC to depositor\n        ERC20(USDC).transfer(msg.sender, refund0)\n    \n    # Refund rest WETH to user if it remains\n    if result.amount0 < amount0ToMint:\n        # Remove allowance of NonfungiblePositionManger from this contract\n        ERC20(WETH).approve(NonfungiblePositionManagerAddress, 0)\n        # Rest amount of USDC after deposit\n        refund1: uint256 = amount1ToMint - result.amount1\n        # Refund USDC to depositor\n        ERC20(WETH).transfer(msg.sender, refund1)\n\n    return result", "references": [], "imports": []}}, "contractTypes": {"Depositor": {"contractName": "Depositor", "sourceId": "Depositor.vy", "deploymentBytecode": {"bytecode": "0x61063561001161000039610635610000f36003361161000c5761061f565b60003560e01c63d097363c811861061d5760443618610625576004358060020b8118610625576040526024358060020b81186106255760605234156106255742600f810181811061062557905060805263414bf38960c05273b4fbf271143f4fbf7b91a5ded31805e42b2208d660e052735ffbac75efc9547fbc822166fed19b05cd5890bb61010052610bb861012052336101405260805161016052348060011c9050610180526040366101a037602060c061010460dc348060011c905073e592427a0aece92de3edee1f18e0157c058615645af16100f0573d600060003e3d6000fd5b60203d106106255760c05160a05263414bf38960e05273b4fbf271143f4fbf7b91a5ded31805e42b2208d66101005273b4fbf271143f4fbf7b91a5ded31805e42b2208d661012052610bb861014052336101605260805161018052348060011c90506101a0526040366101c037602060e061010460fc348060011c905073e592427a0aece92de3edee1f18e0157c058615645af1610193573d600060003e3d6000fd5b60203d106106255760e05160c05263095ea7b360e05273c36442b4a4522e871399cd717abdd847ab11fe886101005260a05161012052602060e0604460fc6000735ffbac75efc9547fbc822166fed19b05cd5890bb5af16101f9573d600060003e3d6000fd5b60203d106106255760e0518060011c61062557610140526101405063095ea7b360e05273c36442b4a4522e871399cd717abdd847ab11fe886101005260c05161012052602060e0604460fc600073b4fbf271143f4fbf7b91a5ded31805e42b2208d65af161026c573d600060003e3d6000fd5b60203d106106255760e0518060011c610625576101405261014050735ffbac75efc9547fbc822166fed19b05cd5890bb60e05273b4fbf271143f4fbf7b91a5ded31805e42b2208d661010052610bb861012052604051610140526060516101605260a0516101805260c0516101a0526040366101c03733610200524261022052635f734d006102c05260e0516102e052610100516103005261012051610320526101405161034052610160516103605261018051610380526101a0516103a0526101c0516103c0526101e0516103e0526102005161040052610220516104205260806102c06101646102dc600073c36442b4a4522e871399cd717abdd847ab11fe885af161037f573d600060003e3d6000fd5b60803d10610625576102c051610440526102e0518060801c61062557610460526103005161048052610320516104a05261044080516102405260208101516102605260408101516102805260608101516102a05250337f2c057cf23622b35e0ed9529292a5f7e4cc561dc18ad64550b35e47ff7f287dcb610260516102c052610280516102e0526102a0516103005260606102c0a260a0516102805110156105155763095ea7b36102c05273c36442b4a4522e871399cd717abdd847ab11fe886102e05260006103005260206102c060446102dc6000735ffbac75efc9547fbc822166fed19b05cd5890bb5af161047b573d600060003e3d6000fd5b60203d10610625576102c0518060011c61062557610320526103205060a0516102805180820382811161062557905090506102c05263a9059cbb6102e05233610300526102c0516103205260206102e060446102fc6000735ffbac75efc9547fbc822166fed19b05cd5890bb5af16104f8573d600060003e3d6000fd5b60203d10610625576102e0518060011c6106255761034052610340505b60a0516102805110156106165763095ea7b36102c05273c36442b4a4522e871399cd717abdd847ab11fe886102e05260006103005260206102c060446102dc600073b4fbf271143f4fbf7b91a5ded31805e42b2208d65af161057c573d600060003e3d6000fd5b60203d10610625576102c0518060011c61062557610320526103205060c0516102a05180820382811161062557905090506102c05263a9059cbb6102e05233610300526102c0516103205260206102e060446102fc600073b4fbf271143f4fbf7b91a5ded31805e42b2208d65af16105f9573d600060003e3d6000fd5b60203d10610625576102e0518060011c6106255761034052610340505b6080610240f35b505b60006000fd5b600080fda165767970657283000304"}, "runtimeBytecode": {"bytecode": "0x6003361161000c5761061f565b60003560e01c63d097363c811861061d5760443618610625576004358060020b8118610625576040526024358060020b81186106255760605234156106255742600f810181811061062557905060805263414bf38960c05273b4fbf271143f4fbf7b91a5ded31805e42b2208d660e052735ffbac75efc9547fbc822166fed19b05cd5890bb61010052610bb861012052336101405260805161016052348060011c9050610180526040366101a037602060c061010460dc348060011c905073e592427a0aece92de3edee1f18e0157c058615645af16100f0573d600060003e3d6000fd5b60203d106106255760c05160a05263414bf38960e05273b4fbf271143f4fbf7b91a5ded31805e42b2208d66101005273b4fbf271143f4fbf7b91a5ded31805e42b2208d661012052610bb861014052336101605260805161018052348060011c90506101a0526040366101c037602060e061010460fc348060011c905073e592427a0aece92de3edee1f18e0157c058615645af1610193573d600060003e3d6000fd5b60203d106106255760e05160c05263095ea7b360e05273c36442b4a4522e871399cd717abdd847ab11fe886101005260a05161012052602060e0604460fc6000735ffbac75efc9547fbc822166fed19b05cd5890bb5af16101f9573d600060003e3d6000fd5b60203d106106255760e0518060011c61062557610140526101405063095ea7b360e05273c36442b4a4522e871399cd717abdd847ab11fe886101005260c05161012052602060e0604460fc600073b4fbf271143f4fbf7b91a5ded31805e42b2208d65af161026c573d600060003e3d6000fd5b60203d106106255760e0518060011c610625576101405261014050735ffbac75efc9547fbc822166fed19b05cd5890bb60e05273b4fbf271143f4fbf7b91a5ded31805e42b2208d661010052610bb861012052604051610140526060516101605260a0516101805260c0516101a0526040366101c03733610200524261022052635f734d006102c05260e0516102e052610100516103005261012051610320526101405161034052610160516103605261018051610380526101a0516103a0526101c0516103c0526101e0516103e0526102005161040052610220516104205260806102c06101646102dc600073c36442b4a4522e871399cd717abdd847ab11fe885af161037f573d600060003e3d6000fd5b60803d10610625576102c051610440526102e0518060801c61062557610460526103005161048052610320516104a05261044080516102405260208101516102605260408101516102805260608101516102a05250337f2c057cf23622b35e0ed9529292a5f7e4cc561dc18ad64550b35e47ff7f287dcb610260516102c052610280516102e0526102a0516103005260606102c0a260a0516102805110156105155763095ea7b36102c05273c36442b4a4522e871399cd717abdd847ab11fe886102e05260006103005260206102c060446102dc6000735ffbac75efc9547fbc822166fed19b05cd5890bb5af161047b573d600060003e3d6000fd5b60203d10610625576102c0518060011c61062557610320526103205060a0516102805180820382811161062557905090506102c05263a9059cbb6102e05233610300526102c0516103205260206102e060446102fc6000735ffbac75efc9547fbc822166fed19b05cd5890bb5af16104f8573d600060003e3d6000fd5b60203d10610625576102e0518060011c6106255761034052610340505b60a0516102805110156106165763095ea7b36102c05273c36442b4a4522e871399cd717abdd847ab11fe886102e05260006103005260206102c060446102dc600073b4fbf271143f4fbf7b91a5ded31805e42b2208d65af161057c573d600060003e3d6000fd5b60203d10610625576102c0518060011c61062557610320526103205060c0516102a05180820382811161062557905090506102c05263a9059cbb6102e05233610300526102c0516103205260206102e060446102fc600073b4fbf271143f4fbf7b91a5ded31805e42b2208d65af16105f9573d600060003e3d6000fd5b60203d10610625576102e0518060011c6106255761034052610340505b6080610240f35b505b60006000fd5b600080fda165767970657283000304"}, "abi": [{"type": "event", "name": "Deposit", "inputs": [{"name": "depositor", "type": "address", "indexed": true}, {"name": "liquidity", "type": "uint128", "indexed": false}, {"name": "amount0", "type": "uint256", "indexed": false}, {"name": "amount1", "type": "uint256", "indexed": false}], "anonymous": false}, {"type": "function", "name": "deposit", "stateMutability": "payable", "inputs": [{"name": "tickLower", "type": "int24"}, {"name": "tickUpper", "type": "int24"}], "outputs": [{"name": "", "type": "tuple", "components": [{"name": "tokenId", "type": "uint256"}, {"name": "liquidity", "type": "uint128"}, {"name": "amount0", "type": "uint256"}, {"name": "amount1", "type": "uint256"}]}]}], "userdoc": {}, "devdoc": {}}}}