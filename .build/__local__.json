{"manifest": "ethpm/3", "sources": {"Depositor.vy": {"urls": [], "checksum": {"algorithm": "md5", "hash": "0x2d90b35c76064cbde5fa2ebcb7824c77"}, "content": "# @version 0.3.4\n\nfrom vyper.interfaces import ERC20\n\n# # In goerli\n# # Token address\n# USDC: constant(address) = 0x5FfbaC75EFc9547FBc822166feD19B05Cd5890bb\n# WETH: constant(address) = 0xB4FBF271143F4FBf7B91A5ded31805e42b2208d6\n\n# # Address of NonfungiblePositionManager\n# NonfungiblePositionManagerAddress: constant(address) = 0xC36442b4a4522E871399CD717aBDD847Ab11FE88\n# # Address of Uniswap V3 SwapRouter\n# SwapRouterAddress: constant(address) = 0xE592427A0AEce92De3Edee1F18E0157C05861564\n\n# In mainnet\n# Token address\nUSDC: constant(address) = 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48\nWETH: constant(address) = 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2\n\n# Address of NonfungiblePositionManager\nNonfungiblePositionManagerAddress: constant(address) = 0xC36442b4a4522E871399CD717aBDD847Ab11FE88\n# Address of Uniswap V3 SwapRouter\nSwapRouterAddress: constant(address) = 0xE592427A0AEce92De3Edee1F18E0157C05861564\n\n# Fee tier of Pool\npoolFee: constant(uint256) = 3000\n\n# Parameter in mint function of NonfungiblePositionManager\nstruct MintParams:\n    token0: address\n    token1: address\n    fee: uint24\n    tickLower: int24\n    tickUpper: int24\n    amount0Desired: uint256\n    amount1Desired: uint256\n    amount0Min: uint256\n    amount1Min: uint256\n    recipient: address\n    deadline: uint256\n\n# Arguments for SwapRouter to swap tokens\nstruct ExactInputSingleParams:\n    tokenIn: address\n    tokenOut: address\n    fee: uint24\n    recipient: address\n    deadline: uint256\n    amountIn: uint256\n    amountOutMinimum: uint256\n    sqrtPriceLimitX96: uint160\n\n# Interface of NonfungiblePositionManager\ninterface INonfungiblePositionManager:\n    def mint(params: MintParams) -> (uint256, uint128, uint256, uint256): payable\n\ninterface ISwapRouter:\n    def exactInputSingle(params: ExactInputSingleParams) -> uint256: payable\n\n# Interface of WETH\ninterface IWETH:\n    def deposit(): payable\n\n# Event for logging that user has deposited\nevent Deposit:\n    depositor: indexed(address)\n    liquidity: uint128\n    amount0: uint256\n    amount1: uint256\n\n# Event for Swapping\nevent Swap:\n    depositor: indexed(address)\n    amount: uint256\n    describe: String[100]\n\n# Event to show approve\nevent TokenApproved:\n    target: address\n    amount0: uint256\n    amount1: uint256\n\n# For testing\n@view\n@external\ndef say_hello() -> String[10]:\n    return \"Hello\"\n\n# Deposit with ETH\n@payable\n@external\ndef deposit(tickLower: int24, tickUpper: int24):\n\n    assert msg.value > 0, \"value can't be zero\"\n\n    deadline: uint256 = block.timestamp + 15\n\n    # Swap half amount to USDC\n    amount0ToMint: uint256 = ISwapRouter(SwapRouterAddress).exactInputSingle(\n        ExactInputSingleParams({\n            tokenIn: WETH, \n            tokenOut: USDC, \n            fee: 3000, \n            recipient: self, \n            deadline: deadline, \n            amountIn: msg.value / 2, \n            amountOutMinimum: 0, \n            sqrtPriceLimitX96: 0\n        }), \n        value = msg.value / 2)\n\n    log Swap(self, ERC20(USDC).balanceOf(self), \"USDC success\")\n    \n    amount1ToMint: uint256 = msg.value / 2\n\n    # Swapt half amount to WETH\n    IWETH(WETH).deposit(value = amount1ToMint)\n\n    log Swap(self, ERC20(WETH).balanceOf(self), \"WETH success\")\n\n    # Approve NonfungiblePositionManger to transfer swapped USDC and WETH\n    ERC20(USDC).approve(NonfungiblePositionManagerAddress, amount0ToMint)\n    ERC20(WETH).approve(NonfungiblePositionManagerAddress, amount1ToMint)\n\n    #Check allowance\n    log TokenApproved(\n        NonfungiblePositionManagerAddress, \n        ERC20(USDC).allowance(self, NonfungiblePositionManagerAddress), \n        ERC20(WETH).allowance(self, NonfungiblePositionManagerAddress)\n    )\n\n    # Set mint arguments\n    params: MintParams = MintParams({\n            token0: USDC, \n            token1: WETH, \n            fee: 3000, \n            tickLower: 0, \n            tickUpper: 10000, \n            amount0Desired: amount0ToMint, \n            amount1Desired: amount1ToMint, \n            amount0Min: 0, \n            amount1Min: 0, \n            recipient: msg.sender, \n            deadline: block.timestamp + 100\n        })\n\n    # Deposit to USDC-WETH pool with poolFee tier, etc.\n    INonfungiblePositionManager(NonfungiblePositionManagerAddress).mint(params)\n    \n    # Log deposit\n    # log Deposit(msg.sender, result.liquidity, result.amount0, result.amount1)\n\n    # # Refund rest USDC to user if it remains\n    # if result.amount0 < amount0ToMint:\n    #     # Remove allowance of NonfungiblePositionManger from this contract\n    #     ERC20(USDC).approve(NonfungiblePositionManagerAddress, 0)\n    #     # Rest amount of USDC after deposit\n    #     refund0: uint256 = amount0ToMint - result.amount0\n    #     # Refund USDC to depositor\n    #     ERC20(USDC).transfer(msg.sender, refund0)\n    \n    # # Refund rest WETH to user if it remains\n    # if result.amount0 < amount0ToMint:\n    #     # Remove allowance of NonfungiblePositionManger from this contract\n    #     ERC20(WETH).approve(NonfungiblePositionManagerAddress, 0)\n    #     # Rest amount of USDC after deposit\n    #     refund1: uint256 = amount1ToMint - result.amount1\n    #     # Refund USDC to depositor\n    #     ERC20(WETH).transfer(msg.sender, refund1)\n\n    # return result", "references": [], "imports": []}}, "contractTypes": {"Depositor": {"contractName": "Depositor", "sourceId": "Depositor.vy", "deploymentBytecode": {"bytecode": "0x61075261001161000039610752610000f36003361161000c5761073c565b60003560e01c63d097363c81186106ad5760443618610742576004358060020b8118610742576040526024358060020b811861074257606052346100a75760136080527f76616c75652063616e2774206265207a65726f0000000000000000000000000060a0526080506080518060a001601f826000031636823750506308c379a06040526020606052601f19601f6080510116604401605cfd5b42600f810181811061074257905060805263414bf38960c05273c02aaa39b223fe8d0a0e5c4f27ead9083c756cc260e05273a0b86991c6218b36c1d19d4a2e9eb0ce3606eb4861010052610bb861012052306101405260805161016052348060011c9050610180526040366101a037602060c061010460dc348060011c905073e592427a0aece92de3edee1f18e0157c058615645af161014c573d600060003e3d6000fd5b60203d106107425760c05160a052307fd44afbad7c7ca0c5ed78b11661f1265b41dd49d05f79baf6edab7f76e8232e5260406370a0823160c0523060e052602060c0602460dc73a0b86991c6218b36c1d19d4a2e9eb0ce3606eb485afa6101b8573d600060003e3d6000fd5b60203d106107425760c051610140528061016052600c610100527f555344432073756363657373000000000000000000000000000000000000000061012052610100816101400181518082526020830160208301815181525050508051806020830101601f82600003163682375050601f19601f825160200101169050905081019050610140a2348060011c905060c05263d0e30db060e05273c02aaa39b223fe8d0a0e5c4f27ead9083c756cc23b1561074257600060e0600460fc60c05173c02aaa39b223fe8d0a0e5c4f27ead9083c756cc25af161029d573d600060003e3d6000fd5b307fd44afbad7c7ca0c5ed78b11661f1265b41dd49d05f79baf6edab7f76e8232e5260406370a0823160e0523061010052602060e0602460fc73c02aaa39b223fe8d0a0e5c4f27ead9083c756cc25afa6102fc573d600060003e3d6000fd5b60203d106107425760e051610160528061018052600c610120527f574554482073756363657373000000000000000000000000000000000000000061014052610120816101600181518082526020830160208301815181525050508051806020830101601f82600003163682375050601f19601f825160200101169050905081019050610160a263095ea7b360e05273c36442b4a4522e871399cd717abdd847ab11fe886101005260a05161012052602060e0604460fc600073a0b86991c6218b36c1d19d4a2e9eb0ce3606eb485af16103db573d600060003e3d6000fd5b60203d106107425760e0518060011c61074257610140526101405063095ea7b360e05273c36442b4a4522e871399cd717abdd847ab11fe886101005260c05161012052602060e0604460fc600073c02aaa39b223fe8d0a0e5c4f27ead9083c756cc25af161044e573d600060003e3d6000fd5b60203d106107425760e0518060011c6107425761014052610140507fdcf884b862a66b6c40deab0b67760588a0a8ecb29ae86476959131cc40a0e48e73c36442b4a4522e871399cd717abdd847ab11fe886101a05263dd62ed3e60e052306101005273c36442b4a4522e871399cd717abdd847ab11fe8861012052602060e0604460fc73a0b86991c6218b36c1d19d4a2e9eb0ce3606eb485afa6104f7573d600060003e3d6000fd5b60203d106107425760e0516101c05263dd62ed3e61014052306101605273c36442b4a4522e871399cd717abdd847ab11fe88610180526020610140604461015c73c02aaa39b223fe8d0a0e5c4f27ead9083c756cc25afa61055d573d600060003e3d6000fd5b60203d1061074257610140516101e05260606101a0a173a0b86991c6218b36c1d19d4a2e9eb0ce3606eb4860e05273c02aaa39b223fe8d0a0e5c4f27ead9083c756cc261010052610bb8610120526000610140526127106101605260a0516101805260c0516101a0526040366101c037336102005242606481018181106107425790506102205263883164566102405260e051610260526101005161028052610120516102a052610140516102c052610160516102e05261018051610300526101a051610320526101c051610340526101e051610360526102005161038052610220516103a052608061024061016461025c600073c36442b4a4522e871399cd717abdd847ab11fe885af1610677573d600060003e3d6000fd5b60803d1061074257610240516103c052610260518060801c610742576103e05261028051610400526102a051610420526103c050005b346107425763b4598503811861073a57600436186107425760208060805260056040527f48656c6c6f00000000000000000000000000000000000000000000000000000060605260408160800181518082526020830160208301815181525050508051806020830101601f82600003163682375050601f19601f8251602001011690509050810190506080f35b505b60006000fd5b600080fda165767970657283000304"}, "runtimeBytecode": {"bytecode": "0x6003361161000c5761073c565b60003560e01c63d097363c81186106ad5760443618610742576004358060020b8118610742576040526024358060020b811861074257606052346100a75760136080527f76616c75652063616e2774206265207a65726f0000000000000000000000000060a0526080506080518060a001601f826000031636823750506308c379a06040526020606052601f19601f6080510116604401605cfd5b42600f810181811061074257905060805263414bf38960c05273c02aaa39b223fe8d0a0e5c4f27ead9083c756cc260e05273a0b86991c6218b36c1d19d4a2e9eb0ce3606eb4861010052610bb861012052306101405260805161016052348060011c9050610180526040366101a037602060c061010460dc348060011c905073e592427a0aece92de3edee1f18e0157c058615645af161014c573d600060003e3d6000fd5b60203d106107425760c05160a052307fd44afbad7c7ca0c5ed78b11661f1265b41dd49d05f79baf6edab7f76e8232e5260406370a0823160c0523060e052602060c0602460dc73a0b86991c6218b36c1d19d4a2e9eb0ce3606eb485afa6101b8573d600060003e3d6000fd5b60203d106107425760c051610140528061016052600c610100527f555344432073756363657373000000000000000000000000000000000000000061012052610100816101400181518082526020830160208301815181525050508051806020830101601f82600003163682375050601f19601f825160200101169050905081019050610140a2348060011c905060c05263d0e30db060e05273c02aaa39b223fe8d0a0e5c4f27ead9083c756cc23b1561074257600060e0600460fc60c05173c02aaa39b223fe8d0a0e5c4f27ead9083c756cc25af161029d573d600060003e3d6000fd5b307fd44afbad7c7ca0c5ed78b11661f1265b41dd49d05f79baf6edab7f76e8232e5260406370a0823160e0523061010052602060e0602460fc73c02aaa39b223fe8d0a0e5c4f27ead9083c756cc25afa6102fc573d600060003e3d6000fd5b60203d106107425760e051610160528061018052600c610120527f574554482073756363657373000000000000000000000000000000000000000061014052610120816101600181518082526020830160208301815181525050508051806020830101601f82600003163682375050601f19601f825160200101169050905081019050610160a263095ea7b360e05273c36442b4a4522e871399cd717abdd847ab11fe886101005260a05161012052602060e0604460fc600073a0b86991c6218b36c1d19d4a2e9eb0ce3606eb485af16103db573d600060003e3d6000fd5b60203d106107425760e0518060011c61074257610140526101405063095ea7b360e05273c36442b4a4522e871399cd717abdd847ab11fe886101005260c05161012052602060e0604460fc600073c02aaa39b223fe8d0a0e5c4f27ead9083c756cc25af161044e573d600060003e3d6000fd5b60203d106107425760e0518060011c6107425761014052610140507fdcf884b862a66b6c40deab0b67760588a0a8ecb29ae86476959131cc40a0e48e73c36442b4a4522e871399cd717abdd847ab11fe886101a05263dd62ed3e60e052306101005273c36442b4a4522e871399cd717abdd847ab11fe8861012052602060e0604460fc73a0b86991c6218b36c1d19d4a2e9eb0ce3606eb485afa6104f7573d600060003e3d6000fd5b60203d106107425760e0516101c05263dd62ed3e61014052306101605273c36442b4a4522e871399cd717abdd847ab11fe88610180526020610140604461015c73c02aaa39b223fe8d0a0e5c4f27ead9083c756cc25afa61055d573d600060003e3d6000fd5b60203d1061074257610140516101e05260606101a0a173a0b86991c6218b36c1d19d4a2e9eb0ce3606eb4860e05273c02aaa39b223fe8d0a0e5c4f27ead9083c756cc261010052610bb8610120526000610140526127106101605260a0516101805260c0516101a0526040366101c037336102005242606481018181106107425790506102205263883164566102405260e051610260526101005161028052610120516102a052610140516102c052610160516102e05261018051610300526101a051610320526101c051610340526101e051610360526102005161038052610220516103a052608061024061016461025c600073c36442b4a4522e871399cd717abdd847ab11fe885af1610677573d600060003e3d6000fd5b60803d1061074257610240516103c052610260518060801c610742576103e05261028051610400526102a051610420526103c050005b346107425763b4598503811861073a57600436186107425760208060805260056040527f48656c6c6f00000000000000000000000000000000000000000000000000000060605260408160800181518082526020830160208301815181525050508051806020830101601f82600003163682375050601f19601f8251602001011690509050810190506080f35b505b60006000fd5b600080fda165767970657283000304"}, "abi": [{"type": "event", "name": "Deposit", "inputs": [{"name": "depositor", "type": "address", "indexed": true}, {"name": "liquidity", "type": "uint128", "indexed": false}, {"name": "amount0", "type": "uint256", "indexed": false}, {"name": "amount1", "type": "uint256", "indexed": false}], "anonymous": false}, {"type": "event", "name": "Swap", "inputs": [{"name": "depositor", "type": "address", "indexed": true}, {"name": "amount", "type": "uint256", "indexed": false}, {"name": "describe", "type": "string", "indexed": false}], "anonymous": false}, {"type": "event", "name": "TokenApproved", "inputs": [{"name": "target", "type": "address", "indexed": false}, {"name": "amount0", "type": "uint256", "indexed": false}, {"name": "amount1", "type": "uint256", "indexed": false}], "anonymous": false}, {"type": "function", "name": "say_hello", "stateMutability": "view", "inputs": [], "outputs": [{"name": "", "type": "string"}]}, {"type": "function", "name": "deposit", "stateMutability": "payable", "inputs": [{"name": "tickLower", "type": "int24"}, {"name": "tickUpper", "type": "int24"}], "outputs": []}], "userdoc": {}, "devdoc": {}}}}